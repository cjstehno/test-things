<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FileMatcher.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">test-things</a> &gt; <a href="index.source.html" class="el_package">io.github.cjstehno.testthings.match</a> &gt; <span class="el_source">FileMatcher.java</span></div><h1>FileMatcher.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2022 Christopher J. Stehno
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.github.cjstehno.testthings.match;

import lombok.RequiredArgsConstructor;
import lombok.val;
import org.hamcrest.BaseMatcher;
import org.hamcrest.Description;
import org.hamcrest.Matcher;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;

import static io.github.cjstehno.testthings.match.PredicateMatcher.matchesPredicate;
import static java.lang.String.join;
import static java.nio.file.Files.readAllLines;
import static lombok.AccessLevel.PRIVATE;
import static org.hamcrest.CoreMatchers.equalTo;

/**
 * Matchers useful for matching File information.
 */
<span class="fc" id="L37">public abstract class FileMatcher extends BaseMatcher&lt;File&gt; {</span>

    /**
     * Creates a file matcher for matching the file name.
     *
     * @param nameMatcher the name string matcher
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; nameMatches(final Matcher&lt;String&gt; nameMatcher) {
<span class="fc" id="L46">        return new FileNameMatcher(nameMatcher);</span>
    }

    /**
     * Creates a file matcher for matching the file name.
     *
     * @param name expected name
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; nameEqualTo(final String name) {
<span class="fc" id="L56">        return nameMatches(equalTo(name));</span>
    }

    /**
     * Creates a file matcher for matching the file extension (not including the dot).
     *
     * @param extensionMatcher the extension string matcher
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; extensionMatches(final Matcher&lt;String&gt; extensionMatcher) {
<span class="fc" id="L66">        return new FileExtensionMatcher(extensionMatcher);</span>
    }

    /**
     * Creates a file matcher for matching the file extension (not including the dot).
     *
     * @param extension the file extension
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; extensionEqualTo(final String extension) {
<span class="fc" id="L76">        return extensionMatches(equalTo(extension));</span>
    }

    /**
     * Creates a file matcher for matching whether a file exists.
     *
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; fileExists() {
<span class="fc" id="L85">        return matchesPredicate(File::exists, &quot;a file that exists&quot;);</span>
    }

    /**
     * Creates a file matcher for matching whether is readable.
     *
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; isReadable() {
<span class="fc" id="L94">        return matchesPredicate(File::canRead, &quot;a file that is readable&quot;);</span>
    }

    /**
     * /**
     * Creates a file matcher for matching whether a file is writable.
     *
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; isWritable() {
<span class="fc" id="L104">        return matchesPredicate(File::canRead, &quot;a file that is writable&quot;);</span>
    }

    /**
     * Creates a file matcher for matching whether a file is a file (not a directory).
     *
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; isFile() {
<span class="fc" id="L113">        return matchesPredicate(File::isFile, &quot;a file that is a normal file&quot;);</span>
    }

    /**
     * Creates a file matcher for matching whether a file is a directory.
     *
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; isDirectory() {
<span class="fc" id="L122">        return matchesPredicate(File::isDirectory, &quot;a file that is a directory&quot;);</span>
    }

    /**
     * Creates a file matcher for matching the content bytes.
     *
     * @param arrayMatcher the byte array matcher
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; fileBytesMatch(final Matcher&lt;byte[]&gt; arrayMatcher) {
<span class="fc" id="L132">        return new FileBytesMatcher(arrayMatcher);</span>
    }

    /**
     * Creates a file matcher for matching the content as a string. Multiline content will be joined with line breaks
     * (i.e. &quot;\n&quot;).
     *
     * @param stringMatcher the string text matcher
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; fileTextMatches(final Matcher&lt;String&gt; stringMatcher) {
<span class="fc" id="L143">        return new FileTextMatcher(stringMatcher);</span>
    }

    /**
     * Creates a file matcher for matching the size of a file.
     *
     * @param sizeMatcher the matcher for the size of the file
     * @return the file matcher
     */
    public static Matcher&lt;File&gt; fileSizeMatches(final Matcher&lt;Long&gt; sizeMatcher) {
<span class="fc" id="L153">        return new FileSizeMatcher(sizeMatcher);</span>
    }

<span class="fc" id="L156">    @RequiredArgsConstructor(access = PRIVATE)</span>
    private static class FileBytesMatcher extends FileMatcher {
        private final Matcher&lt;byte[]&gt; contentMatcher;

        @Override public boolean matches(final Object actual) {
            try {
<span class="fc" id="L162">                return contentMatcher.matches(Files.readAllBytes(((File) actual).toPath()));</span>
<span class="nc" id="L163">            } catch (final IOException e) {</span>
<span class="nc" id="L164">                return false;</span>
            }
        }

        @Override public void describeTo(final Description description) {
<span class="nc" id="L169">            description.appendText(&quot;a file with content matching &quot;);</span>
<span class="nc" id="L170">            contentMatcher.describeTo(description);</span>
<span class="nc" id="L171">        }</span>
    }

<span class="fc" id="L174">    @RequiredArgsConstructor(access = PRIVATE)</span>
    private static class FileTextMatcher extends FileMatcher {
        private final Matcher&lt;String&gt; contentMatcher;

        @Override public boolean matches(final Object actual) {
            try {
<span class="fc" id="L180">                return contentMatcher.matches(join(&quot;\n&quot;, readAllLines(((File) actual).toPath())));</span>
<span class="nc" id="L181">            } catch (final IOException e) {</span>
<span class="nc" id="L182">                return false;</span>
            }
        }

        @Override public void describeTo(final Description description) {
<span class="nc" id="L187">            description.appendText(&quot;a file with content matching &quot;);</span>
<span class="nc" id="L188">            contentMatcher.describeTo(description);</span>
<span class="nc" id="L189">        }</span>
    }

<span class="fc" id="L192">    @RequiredArgsConstructor(access = PRIVATE)</span>
    private static class FileNameMatcher extends FileMatcher {
        private final Matcher&lt;String&gt; nameMatcher;

        @Override public boolean matches(final Object actual) {
<span class="fc" id="L197">            return nameMatcher.matches(((File) actual).getName());</span>
        }

        @Override public void describeTo(final Description description) {
<span class="fc" id="L201">            description.appendText(&quot;A file with name matching &quot;);</span>
<span class="fc" id="L202">            nameMatcher.describeTo(description);</span>
<span class="fc" id="L203">        }</span>
    }

<span class="fc" id="L206">    @RequiredArgsConstructor(access = PRIVATE)</span>
    private static class FileSizeMatcher extends FileMatcher {
        private final Matcher&lt;Long&gt; sizeMatcher;

        @Override public boolean matches(final Object actual) {
<span class="fc" id="L211">            val actualFile = (File) actual;</span>
<span class="fc" id="L212">            System.out.println(actualFile.length());</span>
<span class="fc" id="L213">            return sizeMatcher.matches(actualFile.length());</span>
        }

        @Override public void describeTo(final Description description) {
<span class="fc" id="L217">            description.appendText(&quot;a file with size matching &quot;);</span>
<span class="fc" id="L218">            sizeMatcher.describeTo(description);</span>
<span class="fc" id="L219">        }</span>
    }

<span class="fc" id="L222">    @RequiredArgsConstructor(access = PRIVATE)</span>
    private static class FileExtensionMatcher extends FileMatcher {
        private final Matcher&lt;String&gt; extensionMatcher;

        @Override public boolean matches(final Object actual) {
<span class="fc" id="L227">            val actualName = ((File) actual).getName();</span>
<span class="fc" id="L228">            val actualExt = actualName.substring(actualName.lastIndexOf('.') + 1);</span>
<span class="fc" id="L229">            return extensionMatcher.matches(actualExt);</span>
        }

        @Override public void describeTo(final Description description) {
<span class="fc" id="L233">            description.appendText(&quot;A file with extension matching &quot;);</span>
<span class="fc" id="L234">            extensionMatcher.describeTo(description);</span>
<span class="fc" id="L235">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>